<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <head>
        <title>Line Chart</title>
        <script src="Chart.min.js"></script>
        <script src="utils.js"></script>
        <style>
            canvas {
                -moz-user-select: none;
                -webkit-user-select: none;
                -ms-user-select: none;
            }
        </style>
    </head>

<body>
    <div style="width:50%;">
        <canvas id="canvas"></canvas>
    </div>
    <br>
    <br>
    <button id="randomizeData">Randomize Data</button>
    <button id="addDataset">Add Dataset</button>
    <button id="removeDataset">Remove Dataset</button>
    <button id="addData">Add Data</button>
    <button id="removeData">Remove Data</button>

</body>

</html>

<script>
    var horasFormatado = [];
    var valoresFormatado = [];
    var horas = [];
    var valores = [];
    fetch('/vendas/usuarios-hora/1', { cache: 'no-store' }).then(function (response) {
        if (response.ok) {
            response.json().then(function (resposta) {

                console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                resposta.reverse();

                for (var i = 0; i < resposta.length; i++) {
                    var registro = resposta[i];
                    // aqui, após 'registro.' use os nomes 
                    // dos atributos que vem no JSON 
                    // que gerou na consulta ao banco de dados

                    //INSERE OS DADOS DO MOMENTO_GRAFICO NO GRAFICO
                    //INSERE OS DADOS DA POTENCIALAMPADA NO GRAFICz

                    horas.push(registro.hora);
                    valores.push(registro.totalUsuario);
                    // DEFINE A VARIAVEL COM O ULTIMO VALOR DO GRAFICO 
                    // SUBSTITUI O CONTEUDO DO OBJ QUE TEM O ID COMO VALOR_FINAL PARA O VALOR DA VARIAVEL
                }
                console.log(valores);
                var indice = 0;
                while (indice < 24) {
                    for (var contador = 0; contador < horas.length; contador++) {
                        if (indice == horas[contador]) {
                            console.log("horas[indice]: " + horas[contador]);
                            valoresFormatado.push(valores[contador]);
                            horasFormatado.push(horas[contador]);
                        } else {
                            if (contador == 1) {
                                console.log("indice: " + indice);
                                horasFormatado.push(indice);
                                valoresFormatado.push(0);
                            }
                        }
                    }
                    indice++;
                }
                console.log("horasFormatado" + horasFormatado);
                console.log("valoresFormatado" + valoresFormatado);
            });
        }
        // CASO DER ALGO ERRADO ELE VAI MOSTRAR NO SERIAL MONITOR
        else {
            console.error('Nenhum dado encontrado ou erro na API');
        }
    })
        .catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });

    var config = {
        type: 'line',
        data: {
            labels: horasFormatado,
            datasets: [{
                label: 'Totem 1',
                backgroundColor: window.chartColors.purpleAlprime,
                borderColor: window.chartColors.purpleAlprime,
                data: valoresFormatado,
                fill: false,
            }]
        },
        options: {
            responsive: true,
            title: {
                display: true,
                text: 'Transações/hora'
            },
            tooltips: {
                mode: 'index',
                intersect: false,
            },
            hover: {
                mode: 'nearest',
                intersect: true
            },
            scales: {
                xAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Horas'
                    }
                }],
                yAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Transações'
                    }
                }]
            }
        }
    };

    window.onload = function () {
        var ctx = document.getElementById('canvas').getContext('2d');
        window.myLine = new Chart(ctx, config);
    };


    </script>